\chapter{Аналитическая часть}

\section{Способы определения моделей}

В системах трехмерного моделирования используются широко используется, каркасные, поверхностные и объемные твердотельные модели. Правильный выбор метода определения моделей на сцене является ключевым фактором, определяющим размер и визуализацию модели в сцене, что в свою очередь способствует точному представлению их формы и размеров.

\subsection{Каркасная модель}
Каркасные модели представляют объекты, созданные из соединенных
ребер, похожие на объекты, сделанные из проволоки. В таких моделях грани объекта не определены, но их границы представлены ребрами. Каркасная модель не имеет поверхности, которые бы скрывали ребра, поэтому она выглядит прозрачной \cite{model_geom}.

Этот тип моделирования относится к категории наиболее примитивных и имеет ряд значительных ограничений. Большинство из них связаны с отсутствием информации о гранях, образованных линиями, а также с невозможностью разграничить внутреннюю и внешнюю зоны в изображении твердого тела. Несмотря на ограничения, каркасная модель занимает меньше памяти и является достаточно эффективной для выполнения простых задач. Этот тип представления часто применяется не столько для моделирования, сколько для отображения моделей в качестве одного из методов визуализации. Наиболее широко каркасное моделирование используется для имитации траектории движения инструмента, выполняющего несложные операции \cite{model_geom_01}.

\textbf{Недостатки каркасной модели:}
\begin{enumerate}
      \item Неоднозначность --- визуализация всех ребер может привести к неясности и непредсказуемым результатам. Видимые грани и невидимые трудно отличить.
      \item Затруднения в идентификации криволинейных граней: каркасная модель не способна адекватно представить поверхности с непостоянной кривизной, например, боковые поверхности цилиндров, что может вводить в заблуждение.
    		\item Ограниченность в обнаружении взаимодействий между компонентами - из-за отсутствия информации о поверхностях, модель не может предсказать возможные конфликты между гранями объекта. ?(Ограничения в выявлении взаимодействий между элементами: отсутствие информации о поверхностях в каркасной модели препятствует анализу возможных взаимных влияний между гранями объекта.)
    \item Трудности в вычислении физических характеристик из-за простоты модели.
   \item Невозможность создания градационных изображений: каркасная модель не предполагает создания тоновых изображений, которые требуют затенения граней, а не ребер \cite{model_geom_01}. ?? % где ставится ссылка на источник, если это список, нужен  ли 5 пункт
\end{enumerate}


\subsection{Поверхностная модель}

Поверхностные модели включают как ребра, так и поверхности, что позволяет более точно представить объект, чем каркасные модели. В поверхностных моделях грани, расположенные спереди, перекрывают грани, находящиеся на заднем плане. Когда изображение выводится на монитор, можно получить более реалистичное представление трехмерного объекта. Поверхностные модели имеют объем, но не имеют массы \cite{model_geom}

Поверхностная модель имеет следующие преимущества по сравнению с каркасным:
\begin{enumerate}
\item Способность распознавания и изображения сложных криволинейных граней.
\item Изображение грани для получения тоновых изображений.
\item Особые построения на поверхности (отверстия).
\item Возможность получения качественного изображения \cite{model_geom_01}.
\end{enumerate}


В основу поверхностной модели положены два основных математических положения:
\begin{enumerate}

\item Любую поверхность можно аппроксимировать
многогранником, каждая грань которого является простейшим плоским
многоугольником;
\item Наряду с плоскими многоугольниками в модели допускаются поверхности второго порядка и аналитически не описываемые поверхности, форму которых можно определить с помощью различных методов аппроксимации и интерполяции. В отличие от каркасного моделирования каждый объект имеет внутреннюю и внешнюю часть \cite{model_geom_01}.
\end{enumerate}

%Поверхностные модели широко применяются в разработке динамических поверхностей, которые взаимодействуют с внешней средой. Примеры таких поверхностей включают фюзеляжи самолетов, обводы судов, кузова автомобилей

Недостаток поверхностной модели --- отсутствует информация, о том, с какой стороны поверхности находится материал, а с какой пустота.

\subsection{Твердотельная модель}

Твердотельное моделирование представляет собой наиболее всесторонний и точный метод создания виртуального аналога реального объекта. В результате применения данного метода формируется монолитная модель будущего изделия, включающая в себя такие элементы как линии, грани и, что особенно важно, образует зону поверхности в рамках геометрической формы объекта с такими ключевыми характеристиками как масса и объем \cite{model_geom_01}.

\textbf{Преимущества твердотельных моделей:}

\begin{enumerate}
\item Полное определение объемной формы с возможностью разграничивать внутренний и внешние области объекта.
\item  Обеспечение автоматического удаления скрытых линий.
\item Автоматическое построение 3D разрезов компонентов, что особенно важно при анализе сложных сборочных изделий.
\item  Применение методов анализа с автоматическим получением изображения точных весовых характеристик методом конечных элементов.
\item Получение тоновых эффектов, манипуляции с источниками
света \cite{model_geom_01}.
\end{enumerate}


\section*{Выбор определения моделей} % мб не надо 
В контексте представленной задачи наиболее оптимальным выбором являются поверхностные модели объектов. Поверхностные модели позволяют детализировать геометрическую форму объекта, минуя углубленное рассмотрение его внутренней структуры и свойств материалов. Данный подход находит свое применение в ситуациях, когда специфика материала объекта не влияет на проводимый анализ. Так, не требуется тратить ресурсы на моделирование внутренних особенностей и характеристик материала, что делает использование поверхностных моделей более рациональным. Каркасные модели в данном контексте не подходят из---за неполноты представления формы объекта, в то время как твердотельные модели избыточны из---за детальности, не требуемой для задачи


\section{Способы представления трехмерных поверхностей}

Для представления трехмерных поверхностей существуют два широко используемых метода:

\begin{enumerate}
\item Метод полигональных сеток: Этот метод представляет объект в виде связанной между собой сетки плоских многоугольников. Несмотря на его простоту и удобство для описания некоторых типов объектов, например, архитектурных конструкций, метод имеет ограниченную точность, особенно в случаях сложных или криволинейных форм.
\item Метод параметрических бикубических кусков: Этот подход использует математические формулы, описывающие координаты поверхностей. Эти уравнения имеют два параметра и варьируются по степеням не выше третьей. Этот подход обеспечивает высокую точность при описании поверхности и требует меньше элементов для описания сложных форм, в сравнении с полигональными сетками \cite{model_geom}.
\end{enumerate}

Исходя из требований к простоте моделирования, экономии ресурсов и приемлемой детализации для задачи макетирования загородной среды, метод полигональных сеток является оптимальным выбором. Благодаря геометрической простоте, он подходит для представления основных элементов и обеспечивает рациональное использование вычислительных ресурсов. При этом, уровень детализации соответствует требованиям проекта, не делая необходимым применение более сложных методов моделирования.

\subsection{Способы описания полигональных сеток}

Существует несколько способов описания полигональных сеток, каждый из которых имеет свои преимущества и недостатки в зависимости от конкретных требований и ограничений приложения.

 \textbf{Наиболее распространенные методы представления полигональных сеток:}
 
	\begin{itemize}
    \item \textbf{Список граней} ---  Один из наиболее распространенных подходов к представлению трехмерных моделей, представляет объект как множество граней и множество вершин. В каждую грань входят как минимум 3 вершины \cite{polygon_mesh}.
    
  \textbf{Преимущества использования списка граней:}
  
	\begin{itemize}
		\item Простота поиска вершин грани: Благодаря тому, что список всех граней содержит информацию обо всех связанных вершинах, поиск вершин грани облегчается.
		\item Возможность динамического обновления формы: Используя графический процессор, форма может быть обновлена динамически без обновления связности граней \cite{polygon_mesh}.
		\end{itemize}
		
	\textbf{Недостатки использования списка граней:}
	
	\begin{itemize}
	\item Трудности при выполнении операций разрыва и объединения граней: Недостаток явной информации о связях между гранями может усложнить выполнение таких операций.
	\item Проблемы с поиском граней: В силу отсутствия явно заданных ребер, поиск всех граней может стать затруднительным \cite{polygon_mesh}.
	\end{itemize}
	
	\item \textbf{вершинное представление} --- Это метод представления модели через коллекцию вершин, которые связаны между собой \cite{polygon_mesh}.

	\textbf{Преимущества использования вершинного представления:}
	
	\begin{itemize}
		\item Простота: Вершинное представление является наиболее базовым и простым способом представления трехмерной модели \cite{polygon_mesh}.
	\end{itemize}

	\textbf{Недостатки использования вершинного представления:}

	\begin{itemize}
		\item Отсутствие явного выражения информации о гранях и рёбрах: Для генерации списка граней для визуализации, требуется пройти по всем данным.
		\item Редкое использование: Из-за ограниченности функционала, вершинное представление редко используется в современных системах визуализации \cite{polygon_mesh}.
	\end{itemize}
	
	\item \textbf{<<Крылатое>> представление} --- Это метод представления модели, который решает проблему перехода от ребра к ребру, путем упорядочивания множества граней вокруг каждого ребра \cite{polygon_mesh}.

	\textbf{Преимущества использования <<крылатого>> представления:}

	\begin{itemize}
		\item Поддержка сложных операций: "Крылатое" представление подходит для операций подразделения поверхностей и интерактивного моделирования, благодаря своей уникальной структуре \cite{polygon_mesh}.
		\end{itemize}

	\textbf{Недостатки использования <<крылатого>> представления:}

	\begin{itemize}
		\item Высокие требования к памяти: Увеличивающаяся сложность структуры приводит к увеличению объема занимаемой памяти при использовании данного представления \cite{polygon_mesh}.
	\end{itemize}
	
\end{itemize}

\section*{Выбор способа описания полигональной сетки} % мб не надо 

В своей работе я выбрал подход к представлению моделей с использованием списка граней, поскольку он предлагает ясное описание граней и удобный доступ к элементам сетки. Список граней позволяет легко и эффективно модифицировать модели, включая добавление, удаление и изменение граней, вершин и ребер. Благодаря этому методу, я могу выполнять различные операции, такие как вычисление нормалей и текстурирование, с высокой эффективностью.

% Важно учесть, что, несмотря на высокую степень гибкости и удобства работы, использование списка граней может потребовать больше памяти по сравнению с другими методами. Однако, учитывая доступные ресурсы памяти и объем моделей, с которыми я работаю, преимущества этого подхода перевешивают его потенциальные недостатки.



\section{Формализация объектов сцены}
 
После изучения и выбора наиболее эффективных методов и технологий, а именно : использование поверхностных моделей для описания трехмерных объектов, применение полигональных сеток для визуализации поверхностей и выбор списка граней для их детализации, можем перейти к конкретизации объектов сцены. 

\section*{Объекты сцены}

\begin{itemize}
\item \textbf{Дома}: Каждый дом формируется четырьмя стенами, крышей, окнами и дверью. В программе доступны два вида домов:
\begin{itemize}
\item <<Стандартный>> дом: одноэтажное здание, занимающее три квадрата на сцене в длину, два квадрата в ширину и два квадрата по высоте, включая крышу.
\item <<Премиальный>> дом: двухэтажное сооружение с гаражом, занимающее три квадрата сцены по каждой из осей: длине, ширине и высоте, включая крышу. Гараж включает в себя стены, крышу и ворота.
\end{itemize}
\item \textbf{Компоненты дома}: Каждый дом состоит из нескольких компонентов, каждый из которых имеет свой цвет:
\begin{itemize}
\item Стены: формируются вертикальными плоскостями, бежевого цвета.
\item Окна: расположены в середине стены, окрашены в голубой цвет.
\item Крыша: составлена из двух треугольников и двух трапеций, коричневого цвета.
\item Дверь: расположена посередине стены, коричневого цвета.
\item Ворота: расположены на двух ячейках стены, коричневого цвета.
\end{itemize}
\item \textbf{Дороги}: занимают один квадрат сцены по ширине и длине, имеют минимальную высоту и темно-серый цвет.
\item \textbf{Тротуары}: по форме и размеру аналогичны дорогам, но окрашены в светло-серый цвет.
\item \textbf{Машины}: включают в себя четыре колеса, стекла и кузов. В программе имеется выбор модели машины,  различного цвета:
\begin{itemize}
\item Кузов: формируется набором плоскостей, имитирующих реальные автомобили. Цвет кузова --- красный или серый.
\item Колеса: представляют собой цилиндрические объекты, черного цвета.
\item Окна: плоские объекты, встроенные в кузов автомобиля, голубого цвета.
\end{itemize}
\item \textbf{Деревья}: состоят из листвы и ствола, занимают две клетки сцены. Листва имеет зеленый цвет, а ствол --- коричневый.
\item \textbf{Кусты}: схожи с деревьями, но без ствола. Занимают одну клетку сцены, листва имеет светло-зеленый оттенок.
\end{itemize}

Все возможные модели заранее определены, при этом программа не позволяет добавлять новые модели или модифицировать существующие. Однако, в программном обеспечении предусмотрена возможность перемещения или удаления объектов на сцене. Также имеется ограничения на размещение моделей на сцене, а именно, машина может размещаться только на дороге. Дома, дороги, тротуары, деревья и кусты могут размещаться только на свободных участках сцены.

\section*{Сцена}
	Сцена представляет собой прямоугольный параллелепипед с определенной сеткой, на которой располагаются модели. У сцены есть только одна сторона, на которой можно размещать модели. Пользователь задает границы сцены, указывая количество квадратов в ширину и длину. Величина каждого квадрата константна и определяется программно. Цвет сцены - светло-зеленый. В программе есть ограничение на размер сцены.


\section*{Источник света}

Для моделирования освещения в компьютерной графике обычно используются три основных типа источников света: точечные, направленные и общий свет (Ambient Light) \cite{light}. В данной работе выбор сделан в пользу точечного источника света.

Точечный источник света излучает свет равномерно во все стороны из определенной точки в 3D-пространстве, что позволяет эффективно управлять освещением и тенями на сцене, учитывая положение объектов относительно источника света. Положение источника света устанавливается относительно текущей точки наблюдения с помощью последовательных поворотов по осям X и Y \cite{light}


\section{Алгоритмы удаления скрытых линий и поверхностей}

В компьютерной графике алгоритмы удаления невидимых линий и поверхностей относятся к наиболее сложным задачам. Это связано с тем, что они помогают определить видимые для наблюдателя элементы сцены из определённой точки пространства. Сложность этой задачи приводит к тому, что идеального общего решения не существует. Вместо этого, для каждой конкретной задачи требуется подбирать наиболее эффективный подход \cite{del_line}.

%Алгоритмы удаления невидимых линий или поверхностей включают в себя сортировку. Ключевая идея сортировки по расстоянию заключается в том, что объекты, находящиеся дальше от точки наблюдения, вероятнее могут быть заслонены объектами, расположенными ближе к наблюдателю. После определения приоритетов в глубине пространства проводится дополнительная сортировка для определения относительного положения объектов \cite{del_line}.

Алгоритмы удаления невидимых частей сцены можно классифицировать на основании следующих критериев:

\begin{enumerate}
	\item Выбор удаляемых частей: возможно удаление невидимых линий, ребер, поверхностей, объемов.
	\item Порядок обработки элементов сцены: удаление может происходить в порядке, определяемом процессом визуализации, или в произвольном порядке.
	\item Зависимость от системы координат: существуют алгоритмы, работающие в пространстве объектов, где каждая из $N$ граней объекта сравнивается с остальными $N - 1$ гранями (объем вычислений растет как $N^2$); а также алгоритмы, работающие в пространстве изображения, когда для каждого пикселя изображения определяется, какая из N граней объекта видна (при разрешении экрана $M\times{M}$ объем вычислений растет как $M^2 \times N$) \cite{del_line}.
\end{enumerate}

\subsection{Алгоритм Робертса}

Алгоритм Робертса (1963) используется для работы с выпуклыми объектами в 3D пространстве. Объекты представляются как многогранники, полученные пересечением плоскостей. Каждый объект описывается списком граней, образованных ребрами и вершинами. Перед определением видимости удаляются нелицевые плоскости. Затем происходит сравнение каждого ребра с каждым объектом, что ведет к значительному объему вычислений. Таким образом, объем вычислений растет как квадрат числа объектов в сцене. В завершении вычисляются новые ребра от пересечения объектов. Преимущества ---  использование мощных и точных математических методов, также алгоритм прост для понимания. \cite{del_line}. 

\subsection{Алгоритм плавающего горизонта}

Алгоритм плавающего горизонта чаще всего применяется для удаления невидимых линий при трехмерном представлении функций, описывающих поверхность в виде F(x, y, z) = 0 \cite{del_line}.

Однако, так как в данной программе поверхности не представлены в виде функций, данный метод не подходит.

\subsection{Z-буферный алгоритм удаления поверхностей}

Был введен Эдом Кэтмулом и представляет собой расширение обычного буфера кадра, который хранит цвета каждого пикселя. В Z-буферном алгоритме, дополнительно к каждому пикселю присваивается значение глубины или Z-координата. При добавлении нового пикселя в буфер, сравнивается его Z-координата с той, что уже находится в буфере. Если новый пиксель ближе к наблюдателю (т.е. его Z-координата больше), его атрибуты и Z-координата записываются в буфер. Этот алгоритм прост в использовании, но требует большого объема памяти для реализации \cite{del_line}. 
    
\textbf{Преимущества Z-буферного алгоритма:}
\begin{itemize}
\item Поддерживает сцены произвольной сложности.
\item Отсутствует необходимость в сортировке, что требуется в других алгоритмах.
\item Вычислительная сложность линейно зависит от числа анализируемых поверхностей.
\end{itemize}

\textbf{Недостатки Z-буферного алгоритма:}
\begin{itemize}
\item Требует значительного объема памяти для буферов.
\item Реализация эффектов прозрачности и освещения может быть трудоемкой.
\end{itemize}

 
\subsection{Вывод}

 На основании рассмотренных алгоритмов удаления невидимых поверхностей, я пришел к выводу, что использование алгоритма Z-буфера является предпочтительным для данной задачи. Размер изображения не является очень большим, поэтому использование Z-буфера не вызовет проблем с памятью. Кроме того, данный алгоритм обеспечивает более эффективную обработку множества объектов в сцене.

Одним из главных преимуществ выбора алгоритма Z-буфера является его легкость в понимании и отладке. Алгоритм основан на простом принципе сравнения глубины пикселей с текущим значением в Z-буфере, что облегчает понимание его работы и возможность быстрой и эффективной отладки.

Таким образом, на основании этих факторов, я буду использовать алгоритм Z-буфера для удаления невидимых объектов в данном контексте.


\section{Алгоритм построения теней}

Учет теней в алгоритмах удаления невидимых поверхностей может быть осуществлен путем модификации Z-буфера. Z-буфер является буфером глубины, который хранит информацию о глубине каждого пикселя в сцене. При обработке геометрических объектов и определении их видимости, Z-буфер используется для сравнения текущей глубины пикселя с сохраненным значением в буфере. Однако, для учета теней необходимо внести изменения в этот процесс.

Одним из подходов к учету теней является модификация Z-буфера путем введения дополнительной информации о тени. Для каждого пикселя в Z-буфере помимо значения глубины сохраняется также значение, указывающее, находится ли данный пиксель в тени или нет. Это значение может быть булевым флагом или числовым значением, указывающим интенсивность тени.

При рендеринге сцены с учетом теней, перед сравнением глубины текущего пикселя с сохраненным значением в Z-буфере, также проверяется, находится ли данный пиксель в тени. Если пиксель находится в тени, то его глубина не обновляется, и он может быть отображен с учетом соответствующей интенсивности тени.

Важным аспектом при использовании модифицированного Z-буфера для учета теней является правильное определение, какие пиксели находятся в тени. Для этого необходимо провести предварительные вычисления и определить, какие объекты или грани находятся между источником света и точкой наблюдения, и соответственно, создают тень.

Таким образом, модификация Z-буфера позволяет эффективно учитывать тени при рендеринге сцены и одновременно выполнять удаление невидимых поверхностей. Этот подход требует дополнительных вычислений и хранения информации о тени в буфере, но позволяет достичь реалистичного отображения теней на изображении.