\chapter{Конструкторский раздел}

В этом разделе представлены требования к программному обеспечению, а также схемы алгоритмов, выбранных для решения поставленных задач и описаны структуры данных, которые будут использоваться при реализации программного обеспечения.

\section{Требования к программному обеспечению}
Программа должна обладать следующей функциональностью:
\begin{itemize}
	\item создавать сцену с определенным размером;
	\item размещать, удалять и перемещать отдельные объекты сцены;
	\item добавлять источник света;
	\item поворачивать, перемещать и масштабировать сцену с объектами.
\end{itemize}

Программа должна корректного реагирования на все действия пользователя.

\if 0
\textbf{Требования к программе: }
\begin{itemize}
	\item для плавной интерактивной работы время реакции программы на действия пользователя должно быть менее одной секунды;
	\item обеспечение корректного реагирования на все действия пользователя.
\end{itemize}
\fi 





\section{Разработка алгоритмов}

Общий алгоритм построения изображения показан на рисунке~\ref{img:mainAlg}.

На рисунке~\ref{img:zbuf} представлена схема алгоритма поиска Z-буфера.
На вход алгоритму подаются следующие параметры: буфер глубины, буфер кадра,
массив с полигонами сцены и атрибуты этих полигонов.

На рисунке~\ref{img:zbuf} представлена схема алгоритма поиска Z-буфера.
На вход алгоритму подаются следующие параметры: буфер глубины, буфер кадра,
массив с полигонами сцены и атрибуты этих полигонов.

На рисунке~\ref{img:idef0-1} показана диграмма IDEF0 построения изображения первого уровня.

\includeimage
	{mainAlg} % Имя файла без расширения (файл должен быть расположен в директории inc/img/)
	{f} % Обтекание (без обтекания)
	{h} % Положение рисунка (см. figure из пакета float)
	{0.3\textwidth} % Ширина рисунка
	{Схема общего алгоритма построения изображения} % Подпись рисунк

\if 0
\subsection{Формальная запись}
\begin{enumerate}
	\item инициализировать кадровый буфер и $z_{\text{буфер}}$;
	\item кадровый буфер заполнить фоном и $z_{\text{буфер}}$ заполнить  минимальным значением $z$;
	\item для каждого многоугольника сцены;
	\begin{enumerate}[label=\arabic{enumi}.\arabic*]
		\item  для каждого пикселя $(x, y)$ в многоугольнике вычислить его глубину $z(x, y)$;
		\begin{enumerate}
			\item  сравнить глубину $z(x, y)$ со значением  $z_{\text{буфер}}$, хранящимся в $z_{\text{буфер}}$ в этой же позиции. 
			
			Если  $z(x, y) > z_{\text{буфер}}(x, y) \Rightarrow z_{\text{буфер}}(x, y) = z(x, y) $ и записать атрибут этого многоугольника (интенсивность, цвет и т. п.);
			
			\item в противном случае никаких действий не производить;
		\end{enumerate}
	\end{enumerate}
	
	\item вывести изображение.
\end{enumerate}

\clearpage

\fi 


\includeimage
	{zbuf} % Имя файла без расширения (файл должен быть расположен в директории inc/img/)
	{f} % Обтекание (без обтекания)
	{h} % Положение рисунка (см. figure из пакета float)
	{0.8\textwidth} % Ширина рисунка
	{Схема алгоритма Z-буфера} % Подпись рисунк
\clearpage


\if 0
\subsection{Формальная запись}

\begin{enumerate}
	\item для каждого источника света.
	
	\begin{enumerate}[label=\arabic{enumi}.\arabic*]
		\item инициализировать Z-буфер (буфер глубины)  и буфер теней, в дальнейшем БГ и БТ, соответственно;
		\item заполнить БГ минимальными значениями глубины.
		Заполнить БТ значениями, указывающими отсутствие тени.
	\end{enumerate}
	
	\item выполнить Z-буферный алгоритм для точки наблюдения, параллельно проверяя видимость поверхности от текущей точки наблюдения и источников света;
	\item для каждого источника света;
	
	\begin{enumerate}[label=\arabic{enumi}.\arabic*]
		\item преобразовать координаты рассматриваемой точки, наблюдателя $(x, y, z)$ в координаты точки источника света $(x', y', z')$;
		\item если $z'(x', y') < БТ(x', y')$, то пиксел высвечивается с учетом его затемнения;
		\item  иначе точка высвечивается без затемнения.
	\end{enumerate}
	
	
\end{enumerate}
\fi

\includeimage
	{zbufmod} % Имя файла без расширения (файл должен быть расположен в директории inc/img/)
	{f} % Обтекание (без обтекания)
	{h} % Положение рисунка (см. figure из пакета float)
	{1\textwidth} % Ширина рисунка
	{Схема модифицированного алгоритма Z-буфера} % Подпись рисунк

\clearpage


%todo (НОРМ ?) - вроде 
\includeimage
	{idef0-1} % Имя файла без расширения (файл должен быть расположен в директории inc/img/)
	{f} % Обтекание (без обтекания)
	{h} % Положение рисунка (см. figure из пакета float)
	{1\textwidth} % Ширина рисунка
	{Диграмма IDEF0 построения изображения первого уровня} % Подпись рисунк




\section{Выбор используемых типов и структур данных}

\begin{enumerate}
	\item Точка задается координатами $(x, y, z)$.
	\item Полигон задается тремя точками и храниться в массиве.
	\item Объекты сцены зада полигонами в виде массива.
	\item Источник света задается углом, по осям $X$ и $Y$ относительно точки наблюдателя. 
\end{enumerate}

\section*{Вывод}

В этом разделе было спроектировано программное обеспечение, были представлены требования к программному обеспечению, а также схемы алгоритмов, выбранных для решения поставленных задач и описаны структуры данных, которые будут использоваться при реализации программного обеспечения.

