\chapter{Аналитический раздел}

В данном разделе описаны: способы определения моделей, методы представления трехмерных поверхностей, формализация объектов сцены, алгоритмы удаление скрытых линий и поверхностей и алгоритмы построения теней.

\section{Способы определения моделей}

В системах трехмерного моделирования используются каркасные, поверхностные и объемные твердотельные модели. 
Правильный выбор метода определения моделей на сцене определяет размер и визуализацию модели на сцене.

\textbf{Каркасная модель} --- это простейшая модель трехмерного объекта, представляющая собой совокупность вершин, соединенных между собой ребрами~\cite{model_geom}.
Главным недостатком данной модели является отсутствие информации о поверхности объекта, что делает невозможным разграничение внутренних и внешних граней, например, как на рисунке~\ref{img:mod1}.
%Этот недостаток заметен, когда у объекта есть отверстия, например, как на рисунке~\ref{img:mod1}, где неясно, какие грани связаны с отверстием.
Каркасная модель занимает меньше памяти и эффективна для простых задач~\cite{model_geom_01}.
%Широко применяется для имитации траектории движения инструмента, выполняющего простые операции~\cite{model_geom_01}.
 

\includeimage
	{mod1} % Имя файла без расширения (файл должен быть расположен в директории inc/img/)
	{f} % Обтекание (без обтекания)
	{h} % Положение рисунка (см. figure из пакета float)
	{0.3\textwidth} % Ширина рисунка
	{Пример каркасной модели} % Подпись рисунк
	

\textbf{Поверхностная модель}, в отличие от каркасной, включает в себя не только вершины и ребра, но также поверхности, создавая визуальный контур объекта~\cite{model_geom}. Каждый объект в данной модели обладает внутренней и внешней частью, как показано на  рисунке~\ref{img:mod2}.

В основу поверхностной модели положены два основных математических положения:
\begin{itemize}
	\item любую поверхность можно аппроксимировать многогранником, где каждая грань представляет собой простейший плоский многоугольник~\cite{model_geom_01};
	\item в модели допускаются не только плоские многоугольники, но и поверхности второго порядка, а также аналитически неописываемые поверхности~\cite{model_geom_01}.
\end{itemize}

\includeimage
	{mod2} % Имя файла без расширения (файл должен быть расположен в директории inc/img/)
	{f} % Обтекание (без обтекания)
	{h} % Положение рисунка (см. figure из пакета float)
	{0.3\textwidth} % Ширина рисунка
	{Пример поверхностной модели} % Подпись рисунк

%Поверхностные модели широко применяются в разработке динамических поверхностей, которые взаимодействуют с внешней средой. Примеры таких поверхностей включают фюзеляжи самолетов, обводы судов, кузова автомобилей

Недостаток поверхностной модели --- отсутствует информация, о том, с какой стороны поверхности находится материал, а с какой пустота.

\textbf{Твердотельная модель} отличается от поверхностной тем, что включает информацию о расположение материала с обеих сторон поверхности~\cite{model_geom_01}.

\textbf{Выбор определения моделей} 

В данной задаче наиболее оптимальными являются поверхностные модели объектов, так как каркасные модели недостаточно полно представляют форму объекта, а твердотельные модели избыточны.


\section{Методы представления трехмерных поверхностей}

\textbf{Метод полигональной сетки} представляет объект в виде связанной между собой сетки плоских многоугольников~\cite{model_geom}, как показано на рисунке~\ref{img:mod3}.

\textbf{Метод параметрических бикубических кусков} использует математические формулы, описывающие координаты поверхностей.
Бикубический --- это термин, который указывает на то, что уравнения, описывающие координаты точек поверхности, содержат две пары параметров с показателями степени, не превышающими третьей~\cite{model_geom}.
Этот подход обеспечивает высокую точность при описании поверхности и требует меньше элементов для представления сложных форм, в сравнении с полигональными сетками.
Однако алгоритмы, работающие с бикубическими кусками сложнее~\cite{model_geom}.

В рамках данной задачи выбран метод полигональной сетки.
Этот выбор обоснован геометрической простотой объектов сцены и отсутствием необходимости использования сложных математических формул.
Использование полигональной сетки позволит применять более простые алгоритмы для обработки объектов~\cite{model_geom}.

\includeimage
	{mod3} % Имя файла без расширения (файл должен быть расположен в директории inc/img/)
	{f} % Обтекание (без обтекания)
	{h} % Положение рисунка (см. figure из пакета float)
	{0.3\textwidth} % Ширина рисунка
	{Пример полигональной сетки, изображающей кролика} % Подпись рисунк


\textbf{Способы описания полигональных сеток}

Наиболее распространенные методы представления полигональных сеток, рассматриваются в \cite{polygon_mesh}.


\begin{enumerate}
	\item Список граней ---  распространенный метод представления трехмерных моделей, описывает объект как множество граней и вершин, где каждая грань имеет минимум 3 вершины.
	\textit{Преимущества:} простота поиска вершин грани, динамическое обновление формы без изменения связности граней.
	\textit{Недостатки:} трудности при операциях разрыва и объединения граней, а также проблемы с поиском граней.
	
	\item Вершинное представление --- это метод представления модели через множества вершин, которые связаны между собой.
	В качестве \textit{преимущества} можно выделить его простату.
	К \textit{недостаткам:} отсутствие явной информации о гранях и ребрах, а также редкое использование в современных системах визуализации.
	
	\item <<Крылатое>> представление --- метод, представляющий модель как упорядоченное множество граней вокруг ребра.
	\textit{Преимущество:} решение проблемы перехода от ребра к ребру через упорядоченное множество граней.
	\textit{Недостаток:} высокие требования к памяти из-за увеличивающейся сложности структуры.
\end{enumerate}


\textbf{Выбор способа описания полигональной сетки} % мб не надо 

Для работы выбран метод представления моделей через список граней, обеспечивающий ясное описание и удобный доступ к элементам сетки.
Этот подход упрощает модификацию моделей, включая добавление, удаление и изменение граней и вершин.
 %Благодаря этому методу, я могу выполнять различные операции, такие как вычисление нормалей.

% Важно учесть, что, несмотря на высокую степень гибкости и удобства работы, использование списка граней может потребовать больше памяти по сравнению с другими методами. Однако, учитывая доступные ресурсы памяти и объем моделей, с которыми я работаю, преимущества этого подхода перевешивают его потенциальные недостатки.

%todo


\section{Формализация объектов сцены}

%После изучения и выбора наиболее эффективных методов определения моделей, а именно: использование поверхностных моделей для описания трехмерных объектов, метода полигональных сеток в качестве способа представления трехмерных поверхностей, а также методики описания полигональных сеток с использованием списка граней, мы можем переходить к конкретизации объектов сцены.

\textbf{Платформа} --- это прямоугольный параллелепипед, состоящий из сетки квадратов, на которой размещаются объекты.
Пользователь определяет границы сцены, указывая количество квадратов по ширине и длине.
Размер каждого квадрата является постоянным и устанавливается программно.
Цвет платформы --- светло-зеленый.

\textbf{Объекты, которые размещаются на платформе.}

\begin{enumerate}
	\item Программа включает два типа домов: "стандартный" (одноэтажное здание, $3 \times 2$ квадрата) и "премиальный" (двухэтажное сооружение с гаражом, $3\times 3$ квадрата, включая гаражные стены, крышу и ворота). 
	Каждый дом представляет собой единый объект, но состоит из нескольких компонентов:
	\textit{крыша} (состоит из двух треугольников и двух трапеций, коричневого цвета),
	\textit{стены} (формируются вертикальными плоскостями, бежевого цвета),
	\textit{окна} (вертикальные плоскости, расположены в середине стены, голубого цвета), 
	\textit{дверь} (вертикальная плоскость, расположена посередине стены, коричневого цвета),
	\textit{ворота} (вертикальная плоскость, расположена посередине двух стен, коричневого цвета).
	
	\item Дороги занимают один квадрат платформы и имеют темно-серый цвет.

	\item Тротуары аналогичны дорогам, светло-серого цвета.
	
	\item Машины представляются как цельный объект из четырех колес, шести стекол и кузова. 
	В программе имеется выбор модели машины, различного цвета. Компоненты машины:
	\textit{кузов} (формируется набором плоскостей, имитирующих реальные автомобили, цвет красный или серый),
	\textit{колеса} (представляют собой цилиндрические объекты, черного цвета),
	\textit{окна} (плоскости, встроенные в кузов автомобиля, голубого цвета).

	\item Деревья состоят из листвы и ствола, представляют цельный объект сцены и занимают один квадрат платформы. Листва имеет зеленый цвет, а ствол коричневый;

	\item Кусты схожи с деревьями, но без ствола. Занимают один квадрат платформы.
\end{enumerate}

Объекты, которые размещаются на платформе определены заранее и не могут быть изменены. ПО позволяет перемещать или удалять объекты на сцене. Есть ограничение на размещение моделей на платформе, а именно, машина может размещаться только на дороге. Дома, дороги, тротуары, деревья и кусты могут размещаться только на свободных квадратов платформы. Размер платформы ограничен.

\textbf{Источник света}

Для моделирования освещения в компьютерной графике обычно используются три основных типа источников света: точечные, направленные и общий свет (от англ. Ambient Light)~\cite{light}.
В данной работе выбор сделан в пользу точечного источника света.

Точечный источник света излучает свет равномерно во все стороны из определенной точки в трехмерном пространстве, что позволяет эффективно управлять освещением и тенями на сцене, учитывая положение объектов относительно источника света.
Положение источника света устанавливается относительно текущей точки наблюдения с помощью последовательных поворотов по осям $X$ и $Y$~\cite{light}.

\section{Алгоритмы удаления скрытых линий и поверхностей}

%В компьютерной графике алгоритмы удаления невидимых линий и поверхностей относятся к наиболее сложным задачам, так как они определяют элементы сцены, видимые из конкретной точки пространства. Отсутствие универсального решения делает необходимым выбор наиболее эффективного подхода для каждой конкретной задачи~\cite{del_line}.

%Алгоритмы удаления невидимых линий или поверхностей включают в себя сортировку. Ключевая идея сортировки по расстоянию заключается в том, что объекты, находящиеся дальше от точки наблюдения, вероятнее могут быть заслонены объектами, расположенными ближе к наблюдателю. После определения приоритетов в глубине пространства проводится дополнительная сортировка для определения относительного положения объектов \cite{del_line}.


Алгоритмы удаления невидимых частей сцены классифицируются на основании следующих критериев:

\begin{enumerate}
	\item выбор удаляемых частей: линий, ребер, поверхностей, объемов;
	\item порядок обработки элементов сцены: удаление может быть определено процессом визуализации или выполняться в произвольном порядке;
	\item зависимость от системы координат: существуют алгоритмы, работающие в пространстве объектов, где каждая из $N$ граней объекта сравнивается с остальными $N - 1$ гранями (объем вычислений растет как $N^2$), а также алгоритмы, работающие в пространстве изображения, когда для каждого пикселя изображения определяется, какая из $N$ граней объекта видна (при разрешении экрана $M\times{M}$ объем вычислений растет как $M^2 \times N$)~\cite{del_line}.
\end{enumerate}

\textbf{Алгоритм Робертса} 

Алгоритм применяется к выпуклым объектам в трехмерном пространстве, представленным как многогранники, образованные пересечением плоскостей~\cite{del_line}.

Алгоритм Робертса состоит из следующих шагов~\cite{del_line}.
\begin{enumerate}
	\item Удаление нелицевых плоскостей перед определением видимости.
	\item Сравнение каждого ребра с каждым объектом (вызывает значительный объем вычислений, растущий квадратично по числу объектов в сцене).
	\item Вычисляются новые ребра от пересечения объектов. 
\end{enumerate}
	
%Преимущества ---  использование мощных и точных математических методов, также алгоритм прост для понимания. \cite{del_line}. 


%\subsection{Алгоритм плавающего горизонта}

%Алгоритм плавающего горизонта чаще всего применяется для удаления невидимых линий при трехмерном представлении функций, описывающих поверхность в виде $F(x, y, z) = 0$ \cite{del_line}.

%Однако, так как в данной программе поверхности не представлены в виде функций, данный метод не подходит.

\textbf{Z-буферный алгоритм удаления поверхностей}

Алгоритм представляет собой расширение обычного буфера кадра, который хранит цвета каждого пикселя.
В Z-буферном алгоритме, дополнительно к каждому пикселю присваивается значение глубины (Z-координата).
При добавлении нового пикселя в буфер, сравнивается его Z-координата с той, что уже находится в буфере.
Если новый пиксель ближе к наблюдателю (т.е. его Z-координата больше, рисунок~\ref{img:zbufExample}), его атрибуты и Z-координата записываются в буфер~\cite{del_line}.
Пример работы алгоритма на рисунке~\ref{img:exz}. 
%Этот алгоритм прост в использовании, но требует большого объема памяти для реализации . 
	
\includeimage
	{zbufExample} % Имя файла без расширения (файл должен быть расположен в директории inc/img/)
	{f} % Обтекание (без обтекания)
	{h} % Положение рисунка (см. figure из пакета float)
	{0.6\textwidth} % Ширина рисунка
	{Визуализация состояния Z-буфера} % Подпись рисунк

\includeimage
	{exz} % Имя файла без расширения (файл должен быть расположен в директории inc/img/)
	{f} % Обтекание (без обтекания)
	{h} % Положение рисунка (см. figure из пакета float)
	{0.7\textwidth} % Ширина рисунка
	{Работа алгоритма с Z-буфером} % Подпись рисунк

Преимущества Z-буферного алгоритма: поддерживает сцены произвольной сложности,
отсутствует необходимость в сортировке, что требуется в других алгоритмах,
вычислительная сложность линейно зависит от числа анализируемых поверхностей. Недостаток Z-буферного алгоритма: требует значительного объема памяти для буферов~\cite{del_line}.

%Так как используемый источник освещения является точечным, то есть излучающим свет во всех направлениях, то для генерации теней необходимо произвести построение сцены 6 раз для разных направлений камеры: вдоль и против осей OX, OY и OZ. В результате образуется так называемая кубическая карта теней, в которой содержатся значения глубин всех освещенных участков сцены. 
%Этот способ генерации теней требует значительного числа вычислений, однако они выполняются только при перестроении сцены, то есть при изменении положения камеры заново вычислять значения в карте теней не нужно. Таким образом метод кубической карты теней позволяет сохранить плавность подачи картинки при перемещении по сцене, поэтому используется в данном курсовом проекте.



\if 0
\subsection{Алгоритм, использующий список приоритетов.}

Алгоритмы, использующие список приоритетов, предполагают предварительную сортировку элементов по глубине. Запись в буфер кадра происходит начиная с наиболее удаленных от наблюдателя элементов. Ближе расположенные элементы последующим образом перезаписывают информацию в буфере. Взаимодействие прозрачных элементов с буфером осуществляется через частичную корректировку его содержимого, учитывая атрибуты прозрачности. Подход известен как <<алгоритм художника>>. Это аналогия с тем, как художник создает картину: сначала фон, затем средний план, и в конце передний план. Алгоритм художника --- простейший программный вариант решения «проблемы видимости» \cite{light, del_line}. 

Однако, этот подход имеет недостатки:
\begin{itemize}
	\item \textit{масштабируемость:} временная сложность алгоритма художника сильно зависит от алгоритма сортировки. Это делает подход более подходящим для малых сцен;
	\item \textit{требование к памяти}: алгоритм требует информацию обо всем списке треугольников, что потребляет значительное количество памяти и исключает возможность потоковой реализации рендеринга;
	\item \textit{неопределенность порядка}: алгоритм может дать сбой в некоторых случаях, включая циклическое перекрытие или проникновение многоугольников \cite{light}.
\end{itemize}

\fi

\textbf{Алгоритм Варнока}

Алгоритм Варнока использует принцип когерентности, по которому большие области изображения однородны.
Алгоритм работает в пространстве изображения.
Основная идея --- разбивать окно на подокна до тех пор, пока их содержимое не станет достаточно простым для визуализации, или размер подокна не достигнет заданного предела разрешения~\cite{del_line, varnok}.

Конкретная реализация зависит от метода разбиения окна и критерия, определяющего простоту содержимого окна.
В оригинальной версии алгоритма окно делится на четыре равных по размеру подокна.
Вариант Вейлера и Азертона предполагает разбиение окна по ребрам изображаемых многоугольников. Эффективность данного алгоритма зависит от сложности сцены. Использование полигональной сетки может замедлить его выполнение~\cite{varnok}.


\textbf{Алгоритм прямой и обратной трассировки лучей} 

Алгоритмы используются для отслеживания траектории лучей от источника света до камеры, учитывая взаимодействие с объектами на пути. 

Прямая трассировка лучей строит траектории лучей от всех источников света до всех точек сцены, включая те, которые не попадают в камеру. Из-за этого, метод считается неэффективным~\cite{ray_tracing}.

Обратная трассировка лучей --- алгоритм при котором отслеживание лучей осуществляется не от источников света, а в обратном направлении от точки наблюдения. 
Учтены только лучи, влияющие на формирование изображения (см. рисунок~\ref{img:lightback}).
Недостатки алгоритма включают неучет вторичного освещения, высокую вычислительную стоимость и дискретность первичных лучей.
Тем не менее, алгоритм поддерживает расчет теней, многократных отражений и преломлений~\cite{ray_tracing}.

\includeimage
	{lightback} % Имя файла без расширения (файл должен быть расположен в директории inc/img/)
	{f} % Обтекание (без обтекания)
	{h} % Положение рисунка (см. figure из пакета float)
	{0.5\textwidth} % Ширина рисунка
	{Схема обратной трассировки лучей} % Подпись рисунк
%todo (норм ?)
\textbf{Выбор алгоритма удаления скрытых линий и поверхностей}

На основании рассмотренных алгоритмов, Z-буфер является оптимальным выбором для удаления невидимых линий и поверхностей. Он обеспечит быструю обработку сцен любой сложности и адаптируется под изменения в освещении и закраске. При небольшом размере изображения Z-буфер эффективно обрабатывает большое количество объектов без проблем с памятью. 
%:Благодаря простоте понимания и отладки, алгоритм Z-буфера является доступным и эффективным решением для данной задачи.

\if 0
\section{Модель освещения}

Модели освещения классифицируются на глобальные и локальные. Глобальные модели анализируют отражение и преломление света от объектов, не являющихся прямыми источниками освещения, что требует значительных вычислительных затрат. В данной работе применяются локальные модели, ограничивающиеся учетом света только от прямых источников. Среди них выделяются модель Ламберта и модель Фонга \cite{lightmodfv}.


\subsection{Простая модель}

Простейшая модель освещения складывается из трех основных компонентов светового воздействия, например рисунок \ref{img:light}.

\includeimage
{light} % Имя файла без расширения (файл должен быть расположен в директории inc/img/)
{f} % Обтекание (без обтекания)
{h} % Положение рисунка (см. figure из пакета float)
{0.3\textwidth} % Ширина рисунка
{Пример суммарного освещения} % Подпись рисунк



Формула для расчета простой модели освещения \cite{lightmodf}:
\begin{equation}
	I = I_{a} + I_{d} + I_{s}
\end{equation}

\begin{itemize}
	\item $I_{a}$ --- фоновая компонента;
	\item $I_{d}$ --- диффузная компонента;
	\item $I_{s}$ --- зеркальная компонента.
\end{itemize}

\textit{Фоновая компонента} освещения представляет собой константу, добавляемую к освещенности в каждой точке. Формула для расчета фоновой компоненты освещения приведена ниже \cite{lightmodf} : \begin{equation}
	I_{a}=k_{a} \cdot i_{a}
\end{equation}
\begin{itemize}
	\item $I_{a}$ --- фоновая компонента освещения в точке;
%	\item $k_{a}$​ --- коэффициент, характеризующий способность материала воспринимать фоновое освещение;
%	\item $i_{a}$​ --- интенсивность фонового освещения.
\end{itemize}

Как видно из приведенного выше уравнения, фоновая компонента освещения не зависит от пространственных координат освещаемой точки и источника света.

%
%\textit{Диффузная компонента} модели освещения предполагает, что свет отражается от поверхности с одинаковой интенсивностью во всех направлениях полусферы, повёрнутой наружу относительно поверхности. Эта составляющая расчётов основана на законе Ламберта и выражается формулой  \cite{lightmodf}:
%
%\begin{equation}
%	I_{diff}=I_{d} \cdot k_{diff} \cdot cos(\theta)
%\end{equation}
%
%
%\begin{itemize}
%	\item $I_{diff}​$ --- диффузная составляющая освещённости,
%	\item $I_{d}$​ --- интенсивность падающего светового луча,
%	\item $k_{diff}​$ --- коэффициент диффузного отражения,
%	\item $\theta$ --- угол падения светового луча.
%\end{itemize}

%
%
%\textit{Зеркальная компонента} модели освещения описывает свойства отражения поверхности, позволяя моделировать блики на ней. Она зависит от близости направлений к отраженному лучу и наблюдателю, которая может быть описана формулой \cite{lightmodf}:
%
%\begin{equation}
%	I_{s}=k_{s} \cdot cos^{\alpha}(R, V) \cdot i_{s} = k_{s} \cdot (R, V)^{\alpha} \cdot i_{s}
%\end{equation}
%
%\begin{itemize}
%	\item 	$I_{s}$​ --- зеркальная компонента освещенности.
%	\item $k_{s}$​ --- коэффициент зеркального отражения.
%	\item $i_{s}$​ --- интенсивность зеркального освещения.
%	\item $R$ --- вектор отраженного луча.
%	\item $V$ --- вектор направления к наблюдателю.
%	\item $\alpha$ ---коэффициент блеска, характеризующий материал поверхности.
%\end{itemize}

\subsection{Модель Ламберта}

Модель Ламберта описывает идеальное диффузное освещение, где свет рассеивается равномерно во все стороны после попадания на поверхность. \cite{lightmodf} Она учитывает только ориентацию поверхности (вектор нормали $N$) и направление на источник света $L$. Диффузионное составляющая освещенности вычисляется по закону Ламберта, с использованием косинуса угла между $L$ и $N$, как показано ниже в формуле \cite{lightmodfv}:


\begin{equation}\label{lamber}
	I_{diff}=I_{d} \cdot k_{diff} \cdot \cos{\cdot (\vec L \cdot \vec N)}
\end{equation}

\begin{itemize}
%	\item $I_{diff}​$ --- диффузная составляющая освещенности;
%	\item $I_{d}$​ --- интенсивность рассеянного света;
%	\item $k_{diff}​$ --- коэффициент диффузного отражения;
	\item $\vec L$ -- вектор, направлен из точки на источник;
	\item $\vec N$ --- вектор нормали к точке.
\end{itemize}



\includeimage
	{lamber} % Имя файла без расширения (файл должен быть расположен в директории inc/img/)
	{f} % Обтекание (без обтекания)
	{h} % Положение рисунка (см. figure из пакета float)
	{0.3\textwidth} % Ширина рисунка
	{Модель Ламберта} % Подпись рисунк

Однако, как показывает формула \ref{lamber}, у этой модели есть значительный недостаток: она предполагает одинаковую интенсивность света на всей грани, не учитывая положение наблюдателя


\subsection{Модель Фонга}

Модель Фонга, объединяющая диффузную (по Ламберту) и зеркальную составляющие, обеспечивает не только равномерное освещение материала, но и возможность появления блика, местоположение которого определяется законом равенства углов падения и отражения \cite{lightmodfv}. Яркость увеличивается, когда наблюдатель находится близко к углам отражения. Падающий и отраженный лучи лежат в одной плоскости с нормалью к отражающей поверхности в точке падения, и эта нормаль делит угол между лучами на две равные части как показано на рисунке \ref{img:lamber1}.

\includeimage
{lamber1} % Имя файла без расширения (файл должен быть расположен в директории inc/img/)
{f} % Обтекание (без обтекания)
{h} % Положение рисунка (см. figure из пакета float)
{0.3\textwidth} % Ширина рисунка
{lamber1} % Подпись рисунк


\begin{equation}
	I_{s}=k_{s} \cdot cos^{\alpha}(\vec R, \vec V) \cdot i_{s} = k_{s} \cdot (\vec R, \vec V)^{\alpha} \cdot i_{s}
\end{equation}

\begin{itemize}
%	\item $I_{s}$​ --- зеркальная компонента освещенности;
%	\item $k_{s}$​ --- коэффициент зеркального отражения;
%	\item $i_{s}$​ --- интенсивность зеркального освещения;
	\item $\vec R$ --- вектор отраженного луча;
	\item $\vec V$ --- вектор направления к наблюдателю;
	\item $\alpha$ ---коэффициент блеска, характеризующий материал поверхности.
\end{itemize}


Использование модели Ламберта в моей работе обусловлено её вычислительной эффективностью и простотой, что позволяет быстро и точно моделировать диффузное освещение.
\fi

\section{Алгоритмы построения теней}

\textbf{Модификация Z-буфера}

В алгоритмах отображения сцены можно адаптировать Z-буфер для отслеживания теней.
Изначально, этот буфер хранит данные о глубине каждого пикселя, но для точного отображения теней нужен дополнительный этап.

Первым шагом камера устанавливается на место источника света, позволяя занести данные о глубине каждой точки в теневой буфер. Это гарантирует, что все отмеченные точки расцениваются как освещенные~\cite{letion}.

Далее формируется изображение с точки зрения наблюдателя. На этом этапе каждый пиксель анализируется с учетом его расстояния до источника света и сопоставляется с данными из теневой карты. Если расстояние до пикселя больше значения из теневой карты, пиксель считается находящимся в тени и отображается с акцентом на рассеянном свете, это можно увидеть на примере рисунка~\ref{img:zb}, точка $ B $ имеет большее расстояние до источника света, чем восстановленный из карты теней, следовательно точка $ B $ будет в тени, а точка $ A $  находится на том же расстоянии от источника света, что и восстановлено из карты теней и не будет затемнена. В итоге, модификация Z-буфера позволяет эффективно учесть тени при рендеринге сцены, одновременно выполняя удаление невидимых поверхностей~\cite{letion}.

\includeimage
	{zb} % Имя файла без расширения (файл должен быть расположен в директории inc/img/)
	{f} % Обтекание (без обтекания)
	{h} % Положение рисунка (см. figure из пакета float)
	{0.5\textwidth} % Ширина рисунка
	{Пример определения тени, алгоритмом модификации Z-буфера} % Подпись рисунк


\textbf{Модификация Вейлера-Азертона}

На первом шаге с помощью алгоритма удаления невидимых поверхностей выбираются освещенные грани, т. е. грани, которые видны из положения источника света.
Для увеличения эффективности, в памяти хранятся именно эти грани, что позволяет избежать удвоения обрабатываемых граней для выпуклого многоугольника.
Освещенные многоугольники помечаются и преобразуются к исходной ориентации, где они приписываются к своим прототипам в качестве многоугольников детализации поверхности.
Чтобы избежать появления ложных теней, сцену рассматривают в пределах видимого или отсекающего объема, определенного положением источника света~\cite{letion}.

На втором шаге объединенные данные о многоугольниках обрабатываются из положения наблюдателя. Если какая-то часть не освещена, применяется соответствующее правило затенения.
Если источников света несколько, то используется несколько наборов освещенных граней~\cite{letion}.

%todo (норм? )
\textbf{Выбор алгоритма построения теней}

Выбор модифицированного Z-буфера для построения теней в данном контексте является оптимальным. Это обусловлено его эффективностью и совместимостью с уже используемым Z-буфером для удаления невидимых поверхностей.
Использование одной и той же технологии упрощает интеграцию.

\section{Постановка задачи}

\includeimage
	{idef0-0} % Имя файла без расширения (файл должен быть расположен в директории inc/img/)
	{f} % Обтекание (без обтекания)
	{h} % Положение рисунка (см. figure из пакета float)
	{1\textwidth} % Ширина рисунка
	{Диграмма IDEF0 постановки задачи нулевого уровня} % Подпись рисунк

	
\section*{Вывод}


В представленном разделе были выбраны: поверхностные модели для описания трехмерных объектов,  полигональные сети с использованием списка граней для представления трехмерных поверхностей, а также удаление невидимых ребер алгоритмом Z-буфера и построение теней с использованием модификации Z-буфера. Были формализованы объекты сцены.

Сравнение алгоритмов удаления невидимых линий и поверхностей приведено в таблице~\ref{table:1}, в строке <<Вычислительная сложность>> $N$ и $C$ означают, количество граней и количество пикселей, соответственно.

\begin{table}[h!]
	\centering
	\caption{\raggedleft Сравнение алгоритмов удаления невидимых линий и поверхностей.}\label{table:1}
	\begin{tabularx}{\textwidth}{|X|X|X|X|X|}
		\hline
		& \textbf{z-буфер} & \textbf{Обратная трассировка лучей} & \textbf{Варнок} & \textbf{Робертс} \\
		\hline
		\textbf{Вычисл. сложность} & $O(CN)$ & $O(CN)$ & $O(CN)$ & $O(N^2)$ \\
		\hline
		\textbf{Производит. при сложной сцене} & Высокая & Низкая & Средняя & Низкая \\
		\hline
		\textbf{Рабочее пространство} & Изображение & Изображение & Изображение & Объектное \\
		\hline
		\textbf{Использов. рекурсивных вызовов} & Нет & Да & Да & Нет \\
		\hline
	\end{tabularx}
\end{table}

\if 0
\\
\hline
\textbf{Трудность \newline реализации} & Низкая & Средняя & Средняя & Высокая \\
\hline
\textbf{Производит. при сложной сцене} & Высокая & Низкая & Средняя & Низкая \\
\hline
\textbf{Распростран. в современном ПО} & Высокая & Высокая & Низкая & Низкая \\\hline
\fi
